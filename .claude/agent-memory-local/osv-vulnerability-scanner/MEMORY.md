# OSV Vulnerability Scanner - Agent Memory

## プロジェクト構成

- ロックファイル: `src/composer.lock`, `src/package-lock.json`
- OSV-Scanner v2.3.3 がホスト環境で利用可能（2026-02-19時点）
- Dockerイメージ:
  - `ec-contact-app:latest` (1.33GB, 開発用, vim/git/xdebug/nodejs含む)
  - `ec-contact-app:production` (991MB, 本番用, nodejs除外済み)
  - ベースOS: Debian GNU/Linux 13 (trixie), ベースイメージ: library/php

## スキャン結果サマリ (最終更新: 2026-02-19)

### PHP (Composer) — src/composer.lock
- 118パッケージ検出、**脆弱性なし**

### JavaScript (npm) — src/package-lock.json
- 243パッケージ検出、**1件の脆弱性 (Medium)**
- GHSA-2g4f-4pwh-qvx6 / CVE-2025-69873: `ajv` 6.12.6 (ReDoS, CVSS 5.5)
  - 修正バージョン: 8.18.0
  - 影響元: `eslint`, `@eslint/eslintrc`, `@eslint/core` (全てdevDependencies)
  - 悪用条件: `$data: true` オプション使用時のみ。ESLint用途では非該当

### Docker Image (ec-contact-app:production) — 最新スキャン結果
- **18パッケージに41件の脆弱性** (Critical: 0, High: 10, Medium: 25, Low: 5, Unknown: 1)
- **修正可能**: 1件のみ (gnutls28: 3.8.9-3+deb13u2)
- 詳細は `docker-scan-findings.md` を参照

### Docker Image (ec-contact-app:latest) — 旧スキャン (参考)
- **22パッケージに55件の脆弱性** (nodejs追加分含む)
- nodejs除外により Critical 0件に改善（CVE-2025-55130が解消）

## 重要な知見

### Dockerイメージ (production)
- nodejs除外後: Critical 0件 (latest比較で改善)
- **High (CVSS >= 7.0) 一覧** (10件):
  - glibc: CVE-2026-0861 (8.4), CVE-2025-15281 (7.5), CVE-2026-0915 (7.5)
  - libtasn1-6: CVE-2025-13151 (7.5)
  - pam: CVE-2025-8941 (7.8)
  - expat: CVE-2025-59375 (7.5)
  - python3.13: CVE-2025-13836 (7.5), CVE-2025-8194 (7.5)
  - jaraco.context/setuptools: CVE-2026-23949 (8.6)
  - 全て修正版なし (アップストリーム待ち)
- **修正可能**: gnutls28 → 3.8.9-3+deb13u2 (`apt-get upgrade` で対応)
- python3.13, setuptools, jaraco.context, elfutils, binutils は本番不要な可能性あり
- nginx DEBIAN-CVE-2013-0337: デフォルト設定の問題 (Severity N/A) — 設定で対応済みの場合は実害なし

### ソース依存関係
- 全ての脆弱性は **devDependencies のみ**。本番ビルド成果物には影響なし
- `ajv` v6 は `eslint` の間接依存。直接 `npm install ajv@^8` しても eslint が v6 を持ち続ける
- `ajv` v6 → v8 はメジャーバージョン変更。ESLint側での対応待ちが現実的

## OSV-Scanner コマンド形式 (v2.3.3)

```bash
# Dockerイメージスキャン（タグ必須）
osv-scanner scan image ec-contact-app:production

# 詳細表示（全脆弱性）
osv-scanner scan image --format vertical --all-vulns ec-contact-app:production

# ソースコードスキャン
osv-scanner scan source --lockfile src/composer.lock
osv-scanner scan source --lockfile src/package-lock.json
```

注意: `--docker` フラグは存在しない（旧バージョンの構文）。`scan image` サブコマンドを使用。

## 参考リンク

- GHSA-2g4f-4pwh-qvx6: https://osv.dev/GHSA-2g4f-4pwh-qvx6
- CVE-2025-69873 (ajv ReDoS): https://nvd.nist.gov/vuln/detail/CVE-2025-69873
