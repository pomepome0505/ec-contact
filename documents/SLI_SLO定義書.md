# SLI/SLO定義書

## 1. SLI/SLO概要

本システムは中堅ECサイト「株式会社ライフスタイルマート」の問い合わせ対応システムであり、以下の特性を持つ：

- **代替手段の存在**: システムダウン時は電話問い合わせで対応可能
- **予測不可能なトラフィック変動**: 通常時1-2 req/s → ピーク時10-20 req/s  
※想定値
- **コスト効率の重視**: システム化による削減効果年間156万円

---

## 2. SLI/SLO一覧表

| SLI | SLO目標値 | エラーバジェット | 測定期間 |
|-----|----------|----------------|---------|
| 可用性 | 99.5% | 0.5% | 28日間ローリングウィンドウ |
| APIレイテンシ | 95%ile: 1秒以内 | 5% | 28日間ローリングウィンドウ |
| 画面レイテンシ | 95%ile: 3秒以内 | 5% | 28日間ローリングウィンドウ |

---

## 3. SLI/SLO詳細

### 3-1. 可用性（Availability）

#### SLI定義

```
可用性 = 成功リクエスト数 / 全リクエスト数
```

**測定対象**
- 問い合わせ受付API
- 管理画面（全エンドポイント）

**成功リクエスト**
- HTTPステータスコード: 200, 201, 204
- 応答時間: 30秒以内

**失敗リクエスト**
- HTTPステータスコード: 500, 502, 503, 504
- タイムアウト: 30秒超過

**除外**
- クライアントエラー（400, 401, 403, 404等）

#### SLO目標値

| 測定期間 | 目標値 |
|---------|-------|
| 28日間ローリングウィンドウ | 99.5% |

#### エラーバジェット

**計算**
```
エラーバジェット = 100% - 99.5% = 0.5%
```

**活用方針**

| エラーバジェット残量 | 対応方針 |
|-------------------|---------|
| 80%以上 | 新機能リリース可、実験的な取り組み可 |
| 50-80% | 通常リリース可、リスクの高い変更は慎重に |
| 20-50% | リリース延期検討、安定性重視 |
| 20%未満 | リリース凍結、障害対応に専念 |

---

### 3-2. レイテンシ（Latency）

#### SLI定義

```
APIレイテンシ = リクエスト受信からレスポンス返却までの時間（95パーセンタイル）
画面レイテンシ = リクエスト受信からレスポンス返却までの時間（95パーセンタイル）
```

**測定対象**
- 問い合わせ受付API
- 管理画面（全エンドポイント）

**測定値**
- 95パーセンタイル値

**除外**
- クライアントエラー（400系）

#### SLO目標値

| 対象 | 95%ile | 測定期間 |
|------|-------|---------|
| 問い合わせ受付API | 1秒以内 | 28日間ローリングウィンドウ |
| 管理画面 | 3秒以内 | 28日間ローリングウィンドウ |

#### エラーバジェット

**計算**
```
エラーバジェット = 目標値を超えたリクエストの許容割合 = 5%
```

**活用方針**

| エラーバジェット残量 | 対応方針 |
|-------------------|---------|
| 80%以上 | 新機能リリース可 |
| 50-80% | 通常リリース可、パフォーマンス影響の大きい変更は慎重に |
| 20-50% | パフォーマンス改善優先 |
| 20%未満 | リリース凍結、パフォーマンス改善に専念 |

---

## 4. エラーバジェットの活用

| エラーバジェット残量 | 対応方針 |
|-------------------|---------|
| 80%以上 | 積極的なリリース、実験的な取り組み可 |
| 50-80% | 通常リリース可、リスクの高い変更は慎重に |
| 20-50% | リリース延期検討、安定性重視 |
| 20%未満 | リリース凍結、障害対応・改善に専念 |

---

## 5. SLO達成状況の確認方法

### 5-1. 測定頻度

- **リアルタイム監視**: 1分間隔
- **SLO達成状況**: 1時間ごとに算出
- **レポート作成**: 週次、月次

### 5-2. 確認項目

**日次**
- 各SLIの現在値
- エラーバジェット残量
- 異常検知状況

**週次**
- 28日間ローリングウィンドウのSLO達成状況
- エラーバジェット消費傾向
- ボトルネック分析

**月次**
- 28日間ローリングウィンドウのSLO達成状況（月末時点）
- SLO未達時の原因分析
- SLO目標値の妥当性評価

---

以上